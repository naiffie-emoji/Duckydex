<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Carte interactive</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      touch-action: none;
    }

    #map-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      cursor: grab;
    }

    #map {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: top left;
      image-rendering: pixelated;
    }

    .chunk-highlight {
      position: absolute;
      border: 2px solid white;
      box-sizing: border-box;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="map-container">
    <img id="map" src="carte/map.png" alt="Carte">
    <div id="highlight" class="chunk-highlight" style="display: none;"></div>
  </div>

  <script>
    const map = document.getElementById('map');
    const container = document.getElementById('map-container');
    const highlight = document.getElementById('highlight');

    const zoom = 2; // Zoom par défaut
    const chunkSize = 16;
    const sectionWidth = 30 * chunkSize;
    const sectionHeight = 20 * chunkSize;

    let isDragging = false;
    let startX = 0, startY = 0;
    let offsetX = 0, offsetY = 0;

    map.onload = () => {
      map.style.transform = `scale(${zoom})`;
      map.width *= zoom;
      map.height *= zoom;
    };

    // Drag avec souris ou tactile
    const startDrag = (x, y) => {
      isDragging = true;
      startX = x - offsetX;
      startY = y - offsetY;
      container.style.cursor = 'grabbing';
    };

    const drag = (x, y) => {
      if (!isDragging) return;
      offsetX = x - startX;
      offsetY = y - startY;
      clampOffset();
      updateMapPosition();
    };

    const endDrag = () => {
      isDragging = false;
      container.style.cursor = 'grab';
    };

    const clampOffset = () => {
      const maxX = 0;
      const maxY = 0;
      const minX = container.clientWidth - map.width;
      const minY = container.clientHeight - map.height;
      offsetX = Math.min(maxX, Math.max(minX, offsetX));
      offsetY = Math.min(maxY, Math.max(minY, offsetY));
    };

    const updateMapPosition = () => {
      map.style.left = offsetX + 'px';
      map.style.top = offsetY + 'px';
    };

    // Souris
    container.addEventListener('mousedown', e => startDrag(e.clientX, e.clientY));
    container.addEventListener('mousemove', e => drag(e.clientX, e.clientY));
    container.addEventListener('mouseup', endDrag);
    container.addEventListener('mouseleave', endDrag);

    // Tactile
    container.addEventListener('touchstart', e => {
      const touch = e.touches[0];
      startDrag(touch.clientX, touch.clientY);
    }, { passive: false });
    container.addEventListener('touchmove', e => {
      const touch = e.touches[0];
      drag(touch.clientX, touch.clientY);
    }, { passive: false });
    container.addEventListener('touchend', endDrag);

    // Sélection d’un chunk (section)
    container.addEventListener('click', (e) => {
      const clickX = (e.clientX - offsetX) / zoom;
      const clickY = (e.clientY - offsetY) / zoom;

      const sectionX = Math.floor(clickX / sectionWidth);
      const sectionY = Math.floor(clickY / sectionHeight);

      const highlightX = sectionX * sectionWidth * zoom + offsetX;
      const highlightY = sectionY * sectionHeight * zoom + offsetY;

      highlight.style.left = highlightX + 'px';
      highlight.style.top = highlightY + 'px';
      highlight.style.width = sectionWidth * zoom + 'px';
      highlight.style.height = sectionHeight * zoom + 'px';
      highlight.style.display = 'block';
    });
  </script>
</body>
</html>
