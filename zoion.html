<!DOCTYPE html>    
<html lang="fr">    
<head>    
  <meta charset="UTF-8" />    
  <meta name="viewport" content="width=device-width, initial-scale=1" />    
  <title>Z≈çion</title>    
  <link rel="icon" type="image/png" href="filet-canard.png" />    
  <style>    
    body {    
      margin: 0;    
      font-family: sans-serif;    
      background: #f0f8ff;    
      color: #333;    
    }    
    
    header {    
      background-color: #4dabf7;    
      color: white;    
      padding: 1rem;    
      display: flex;    
      justify-content: space-between;    
      align-items: center;    
    }    
    
    .burger {    
      display: none;    
      flex-direction: column;    
      gap: 4px;    
      cursor: pointer;    
    }    
    
    .burger span {    
      width: 25px;    
      height: 3px;    
      background: white;    
    }    
    
    nav {    
      display: flex;    
      gap: 1rem;    
    }    
    
    nav a {    
      color: white;    
      text-decoration: none;    
      font-weight: bold;    
    }    
    
    main {    
      padding: 2rem;    
      display: flex;    
      flex-direction: column;    
      align-items: center;    
    }    
    
    .card {    
      background: white;    
      border-radius: 12px;    
      padding: 2rem;    
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);    
      text-align: center;    
      max-width: 300px;    
    }    
    
    .card img {    
      width: 150px;    
      height: 150px;    
      object-fit: contain;    
      margin-bottom: 1rem;    
    }

    .xp-bar-container {
      width: 100%;
      height: 20px;
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
      margin: 1rem 0;
    }
    .xp-bar {
      height: 100%;
      background: #38d9a9;
      width: 0%;
      transition: width 0.5s ease;
    }

    select {
      margin-top: 1rem;
      font-size: 1rem;
      padding: 0.4rem;
    }

    button {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #4dabf7;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    .back-btn {    
      margin-top: 2rem;    
      padding: 0.5rem 1rem;    
      background-color: #4dabf7;    
      color: white;    
      border: none;    
      border-radius: 8px;    
      text-decoration: none;    
      font-size: 1rem;    
    }    
    
    @media (max-width: 600px) {    
      nav {    
        display: none;    
        flex-direction: column;    
        background-color: #4dabf7;    
        padding: 1rem;    
      }    
    
      nav.active {    
        display: flex;    
      }    
    
      .burger {    
        display: flex;    
      }    
    }    
  </style>    
</head>    
<body>    
  <header>    
    <h1>Z≈çion</h1>    
    <div class="burger" onclick="toggleMenu()">    
      <span></span><span></span><span></span>    
    </div>    
    <nav id="menu">    
      <a href="index.html">üéÅ Obtenir un Z≈çion</a>    
      <a href="collection.html">üéü Ma collection</a>    
    </nav>    
  </header>    
    
  <main>    
    <div id="zoionCard" class="card">    
      <p>Chargement...</p>    
    </div>    

    <a href="collection.html" class="back-btn">‚¨Ö Retour</a>    
  </main>    
    
  <script>    
    function toggleMenu() {    
      document.getElementById("menu").classList.toggle("active");    
    }    
    
    const params = new URLSearchParams(window.location.search);    
    const id = params.get("id");    
    const card = document.getElementById("zoionCard");    

    // Gestion des XP et niveaux dans localStorage
    // Structure : { [id]: { level: n, xp: m } }
    let levelsData = JSON.parse(localStorage.getItem("zoionLevels") || "{}");

    // XP max par niveau, ici fixe √† 100 mais tu peux changer la formule si tu veux
    function xpMax(level) {
      return 100 + (level - 1) * 20; // par exemple √ßa augmente un peu √† chaque niveau
    }

    // Convert raret√© en multiplicateur XP
    // Commun = 1, Rare = 1.5, √âpique = 2, L√©gendaire = 3
    function rarityMultiplier(rarity) {
      switch (rarity.toLowerCase()) {
        case "commun": return 1;
        case "rare": return 1.5;
        case "√©pique": return 2;
        case "l√©gendaire": return 3;
        default: return 1;
      }
    }

    // Mets √† jour barre XP et affichage niveau
    function updateXPBar(level, xp) {
      const max = xpMax(level);
      const percent = Math.min((xp / max) * 100, 100);
      xpBar.style.width = percent + "%";
      levelSpan.textContent = level;
      xpText.textContent = `${Math.floor(xp)} / ${max} XP`;
    }

    // Sauvegarde dans localStorage
    function saveLevels() {
      localStorage.setItem("zoionLevels", JSON.stringify(levelsData));
    }

    if (!id) {    
      card.innerHTML = "<p>Erreur : aucun identifiant fourni.</p>";    
    } else {    
      fetch("canards.json")    
        .then(res => res.json())    
        .then(data => {    
          const duck = data.find(d => d.id === id);    
          if (!duck) {    
            card.innerHTML = "<p>Z≈çion introuvable.</p>";    
            return;
          }

          // R√©cup niveau et xp ou initialisation
          if (!levelsData[id]) {
            levelsData[id] = { level: 1, xp: 0 };
            saveLevels();
          }
          let { level, xp } = levelsData[id];

          card.innerHTML = `
            <img src="${duck.image}" alt="${duck.name}">
            <h2>${duck.name}</h2>
            <p>Raret√© : ${duck.rarity}</p>
            <p>Niveau : <span id="level">${level}</span></p>
            <div class="xp-bar-container">
              <div class="xp-bar" id="xpBar"></div>
            </div>
            <p id="xpText"></p>

            <label for="feedSelect">Nourrir avec un autre Z≈çion :</label><br/>
            <select id="feedSelect">
              <option value="">-- Choisir un Zoion --</option>
            </select><br/>
            <button id="feedBtn" disabled>Nourrir</button>
            <p id="feedMsg" style="color: green;"></p>
          `;

          const xpBar = document.getElementById("xpBar");
          const levelSpan = document.getElementById("level");
          const xpText = document.getElementById("xpText");
          const feedSelect = document.getElementById("feedSelect");
          const feedBtn = document.getElementById("feedBtn");
          const feedMsg = document.getElementById("feedMsg");

          updateXPBar(level, xp);

          // Charge la collection du joueur pour la liste de nourrissage (hors le zoion courant)
          const collection = JSON.parse(localStorage.getItem("collection") || "[]");
          const others = collection.filter(cid => cid !== id);

          // Pour afficher les options dans la liste d√©roulante
          others.forEach(otherId => {
            const otherDuck = data.find(d => d.id === otherId);
            if (otherDuck) {
              feedSelect.innerHTML += `<option value="${otherId}">${otherDuck.name} (Raret√©: ${otherDuck.rarity})</option>`;
            }
          });

          feedSelect.addEventListener("change", () => {
            feedBtn.disabled = !feedSelect.value;
            feedMsg.textContent = "";
          });

          feedBtn.addEventListener("click", () => {
            const feedId = feedSelect.value;
            if (!feedId) return;

            const feedDuck = data.find(d => d.id === feedId);
            if (!feedDuck) return;

            // R√©cup niveau et xp du zoion nourrisseur
            if (!levelsData[feedId]) {
              levelsData[feedId] = { level: 1, xp: 0 };
              saveLevels();
            }
            const feedLevel = levelsData[feedId].level;

            // Calcul XP √† donner (exemple : base 20 * raret√© * niveau nourrisseur)
            const baseXP = 20;
            const gainedXP = baseXP * rarityMultiplier(feedDuck.rarity) * feedLevel;

            // Ajoute XP au zoion courant
            xp += gainedXP;

            // Level up si besoin
            let leveledUp = false;
            while (xp >= xpMax(level)) {
              xp -= xpMax(level);
              level++;
              leveledUp = true;
            }

            // Met √† jour l‚Äôobjet et stocke
            levelsData[id] = { level, xp };
            saveLevels();

            updateXPBar(level, xp);

            // Message feed
            feedMsg.style.color = "green";
            feedMsg.textContent = `+${Math.floor(gainedXP)} XP gagn√©s${leveledUp ? " - Niveau augment√© !" : ""}`;

            // Optionnel : tu peux aussi supprimer le zoion nourrisseur de la collection
            // ou ajouter une logique sp√©ciale si tu veux.
          });
        })    
        .catch(err => {    
          console.error(err);    
          card.innerHTML = "<p>Erreur lors du chargement des donn√©es.</p>";    
        });    
    }    
  </script>    
</body>    
</html>
